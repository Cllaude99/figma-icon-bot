name: Sync Figma Icons

on:
  # ë§¤ì¼ ì˜¤ì „ 10ì‹œ(UTC)ì— ìë™ ì‹¤í–‰ - í•œêµ­ì‹œê°„ ì˜¤í›„ 7ì‹œ
  # ìŠ¤ì¼€ì¤„ì„ ë³€ê²½í•˜ë ¤ë©´ cron í‘œí˜„ì‹ ìˆ˜ì •: 'ë¶„ ì‹œ ì¼ ì›” ìš”ì¼'
  schedule:
    - cron: '0 10 * * *'

  # GitHub Actions íƒ­ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

  # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ main ë¸Œëœì¹˜ push ì‹œ ì‹¤í–‰í•˜ë ¤ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
  # push:
  #   branches:
  #     - main

jobs:
  sync-icons:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # NPM íŒ¨í‚¤ì§€ë¡œ ì„¤ì¹˜ (ë°°í¬ í›„)
      - name: Install figma-icon-bot
        run: npm install -g figma-icon-bot

      # Figmaì—ì„œ ì•„ì´ì½˜ ë™ê¸°í™” ì‹¤í–‰
      # FIGMA_ACCESS_TOKEN: Repository Secretsì— ë“±ë¡ í•„ìš”
      # GITHUB_TOKEN: ìë™ìœ¼ë¡œ ì œê³µë¨ (PR ìƒì„±ìš©)
      - name: Sync icons from Figma
        env:
          FIGMA_ACCESS_TOKEN: ${{ secrets.FIGMA_ACCESS_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: figma-icon-bot sync

      # ì‹¤íŒ¨ ì‹œ GitHub Issue ìë™ ìƒì„± (í•„ìš”ì‹œ ì£¼ì„ í•´ì œ)
      # ë™ê¸°í™” ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ Issueë¥¼ ìƒì„±í•˜ì—¬ íŒ€ì— ì•Œë¦¼
      - name: Notify on failure
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ğŸš¨ Figma Icon Sync Failed',
              body: `The automated Figma icon sync job failed.

              **Workflow Run:** ${context.payload.repository.html_url}/actions/runs/${context.runId}

              Please check the workflow logs for details.`,
              labels: ['automated', 'figma-sync', 'bug']
            })
